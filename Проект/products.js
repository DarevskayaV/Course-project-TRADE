// =============================================================================
// КЛАСС ДЛЯ ХРАНЕНИЯ И УПРАВЛЕНИЯ ДАННЫМИ О ТОВАРАХ
// 
// ProductStore - это КЛАСС, который представляет собой "склад товаров"
// Он инкапсулирует логику хранения, организации и доступа к данным о товарах
// =============================================================================

/**
 * ОПРЕДЕЛЕНИЕ КЛАССА ProductStore
 * 
 * ТЕОРИЯ: Класс в JavaScript - это шаблон для создания объектов с общими 
 * свойствами и методами. Это основа ООП (Объектно-Ориентированного Программирования)
 * 
 * Синтаксис: class ClassName { ... }
 */
class ProductStore {
  
  /**
   * КОНСТРУКТОР КЛАССА - специальный метод, который вызывается при создании 
   * нового объекта (экземпляра) класса
   * 
   * ТЕОРИЯ: Конструктор инициализирует объект и устанавливает начальные значения
   * Вызывается автоматически при использовании оператора new
   */
  constructor() {
    // =========================================================================
    // ИНИЦИАЛИЗАЦИЯ СТРУКТУРЫ ДАННЫХ ДЛЯ ХРАНЕНИЯ ТОВАРОВ
    // =========================================================================

    /**
     * this.categories - ОСНОВНОЕ ХРАНИЛИЩЕ ТОВАРОВ
     * this - ключевое слово, которое ссылается на ТЕКУЩИЙ ЭКЗЕМПЛЯР класса
     * 
     * ТЕОРИЯ: В JavaScript объекты состоят из пар ключ-значение
     * Здесь используется структура: КАТЕГОРИЯ → МАССИВ ТОВАРОВ
     * 
     * Преимущества такой структуры:
     * - Быстрый поиск по категориям
     * - Логическая группировка товаров
     * - Простота добавления/удаления категорий
     */
    this.categories = {
      
      /**
       * КАТЕГОРИЯ "Предметы декора" - ключ объекта
       * Значение - МАССИВ объектов товаров
       * 
       * Каждый товар представлен объектом с тремя свойствами:
       * - name: string - название товара
       * - price: string - цена с валютой
       * - image: string - путь к изображению
       */
      "Предметы декора": [
        { 
          name: "Арома-свеча", 
          price: "10 Br", 
          image: "images/products/candle.jpeg" 
        },
        { 
          name: "Статуэтка 'Конь'", 
          price: "13 Br", 
          image: "images/products/horse.jpg" 
        },
        { 
          name: "Подушка декоративная", 
          price: "45 Br", 
          image: "images/products/pillow.jpeg" 
        },
      ],

      /**
       * КАТЕГОРИЯ "Игрушки" - вторая группа товаров
       * Содержит 2 товара: плюшевого мишку и мини-гитару
       */
      "Игрушки": [
        { 
          name: "Плюшевый мишка", 
          price: "35 Br", 
          image: "images/products/bear.jpeg" 
        },
        { 
          name: "Мини-гитара", 
          price: "105 Br", 
          image: "images/products/guitar.avif" 
        }
      ],

      /**
       * КАТЕГОРИЯ "Посуда" - третья группа товаров
       * Содержит посуду: кружку и тарелку
       */
      "Посуда": [
        { 
          name: "Чайная кружка", 
          price: "15 Br", 
          image: "images/products/cup.jpg" 
        },
        { 
          name: "Тарелка", 
          price: "8 Br", 
          image: "images/products/dish.webp" 
        }
      ]
    };
    
    /**
     * ТЕОРИЯ СТРУКТУРЫ ДАННЫХ:
     * 
     * this.categories = {
     *   "Категория1": [
     *     { name: "Товар1", price: "10 Br", image: "path1" },
     *     { name: "Товар2", price: "20 Br", image: "path2" }
     *   ],
     *   "Категория2": [
     *     { name: "Товар3", price: "30 Br", image: "path3" }
     *   ]
     * }
     */
  }

  // ===========================================================================
  // МЕТОДЫ КЛАССА - ФУНКЦИОНАЛЬНОСТЬ ДЛЯ РАБОТЫ С ДАННЫМИ
  // ===========================================================================

  /**
   * МЕТОД getAllProducts() - ПОЛУЧЕНИЕ ВСЕХ ТОВАРОВ ИЗ ВСЕХ КАТЕГОРИЙ
   * 
   * @returns {Array} - плоский массив всех товаров без группировки по категориям
   * 
   * ТЕОРИЯ: Метод класса - это функция, привязанная к классу
   * Вызывается как: объект.метод()
   */
  getAllProducts() {
    /**
     * Object.values() - возвращает массив ЗНАЧЕНИЙ объекта
     * 
     * Пример: 
     * Object.values({a: 1, b: 2}) вернет [1, 2]
     * 
     * В нашем случае:
     * Object.values(this.categories) вернет:
     * [
     *   [ {товар1}, {товар2}, {товар3} ], // Предметы декора
     *   [ {товар4}, {товар5} ],           // Игрушки  
     *   [ {товар6}, {товар7} ]            // Посуда
     * ]
     */
    const allCategoriesArrays = Object.values(this.categories);
    
    /**
     * Array.prototype.flat() - "выравнивает" многомерный массив
     * Преобразует массив массивов в один плоский массив
     * 
     * Пример:
     * [[1, 2], [3, 4]].flat() вернет [1, 2, 3, 4]
     * 
     * В нашем случае преобразует:
     * [ [товары_декор], [товары_игрушки], [товары_посуда] ]
     * в:
     * [ товар1, товар2, товар3, товар4, товар5, товар6, товар7 ]
     */
    return allCategoriesArrays.flat();
    
    /**
     * АЛЬТЕРНАТИВНАЯ РЕАЛИЗАЦИЯ БЕЗ flat():
     * return [].concat(...Object.values(this.categories));
     */
  }

  /**
   * МЕТОД getProductsByCategory() - ПОЛУЧЕНИЕ ТОВАРОВ ПО КОНКРЕТНОЙ КАТЕГОРИИ
   * 
   * @param {string} category - название категории для поиска
   * @returns {Array} - массив товаров указанной категории или пустой массив
   * 
   * ТЕОРИЯ: Это метод ДОСТУПА к данным (getter)
   * Предоставляет контролируемый доступ к внутренним данным класса
   */
  getProductsByCategory(category) {
    /**
     * ДОСТУП К СВОЙСТВУ ОБЪЕКТА ПО КЛЮЧУ И ПРОВЕРКА СУЩЕСТВОВАНИЯ
     * 
     * this.categories[category] - получаем массив товаров для категории
     * || [] - оператор ИЛИ возвращает пустой массив если категория не найдена
     * 
     * ТЕОРИЯ: В JavaScript обращение к несуществующему свойству возвращает undefined
     * undefined || [] → [] (пустой массив)
     * 
     * Примеры:
     * - getProductsByCategory("Игрушки") → вернет массив игрушек
     * - getProductsByCategory("Несуществующая") → вернет []
     */
    return this.categories[category] || [];
    
    /**
     * АЛЬТЕРНАТИВНАЯ РЕАЛИЗАЦИЯ:
     * if (this.categories.hasOwnProperty(category)) {
     *   return this.categories[category];
     * } else {
     *   return [];
     * }
     */
  }
}

// =============================================================================
// СОЗДАНИЕ ЭКЗЕМПЛЯРА (ОБЪЕКТА) КЛАССА
// =============================================================================

/**
 * СОЗДАНИЕ ГЛОБАЛЬНОГО ОБЪЕКТА productStore
 * 
 * new ProductStore() - создает НОВЫЙ ЭКЗЕМПЛЯР класса ProductStore
 * 
 * ТЕОРИЯ: 
 * - Класс - это ЧЕРТЕЖ (шаблон)
 * - Объект (экземпляр) - это ДОМ, построенный по чертежу
 * - Можно создать много объектов от одного класса
 * 
 * Процесс создания:
 * 1. Выделяется память для нового объекта
 * 2. Вызывается constructor() класса
 * 3. Возвращается готовый объект
 */
const productStore = new ProductStore();

/**
 * ТЕОРИЯ: ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ
 * 
 * productStore становится доступной во всех скриптах, подключенных ПОСЛЕ этого файла
 * Это позволяет разным частям приложения использовать одни и те же данные
 */